<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Generated Dec 19, 2009 12:18:03 PM by Hibernate Tools 3.2.1.GA -->
<hibernate-mapping>
  <class name="com.jilit.irp.persistence.dto.BasketMaster" table="BASKETMASTER">
    <comment>In case of academic year wise basket is getting maintained then these fields needs to be maintained ...InstituteID, BasketID, BasketCode, BasketDesc,
        SubjectTypeID, DetailRequired and BasketMasterDetail table needs to be updated academic year wise
        </comment>
    <composite-id class="com.jilit.irp.persistence.dto.BasketMasterId" name="id">
      <key-property name="instituteid" type="string">
        <column length="20" name="INSTITUTEID"/>
      </key-property>
      <key-property name="basketid" type="string">
        <column length="20" name="BASKETID"/>
      </key-property>
    </composite-id>
    <many-to-one class="com.jilit.irp.persistence.dto.InstituteMaster" fetch="select" insert="false" lazy="false" name="institutemaster" update="false">
      <column length="20" name="INSTITUTEID" not-null="true"/>
    </many-to-one>
    <many-to-one class="com.jilit.irp.persistence.dto.ProgramMaster" fetch="select" insert="false" lazy="false" name="programmaster" update="false">
      <column length="20" name="INSTITUTEID" not-null="true"/>
      <column length="20" name="PROGRAMID" not-null="true"/>
    </many-to-one>
    <many-to-one class="com.jilit.irp.persistence.dto.SectionMaster" fetch="select" insert="false" lazy="false" name="sectionmaster" update="false">
      <column length="20" name="INSTITUTEID" not-null="true"/>
      <column length="20" name="SECTIONID" not-null="true"/>
    </many-to-one>
    <many-to-one class="com.jilit.irp.persistence.dto.SubjectTypeMaster" fetch="select" insert="false" lazy="false" name="subjecttypemaster" update="false">
      <column length="20" name="INSTITUTEID" not-null="true"/>
      <column length="20" name="SUBJECTTYPEID" not-null="true">
        <comment>Subject Type must be unique is</comment>
      </column>
    </many-to-one>
    <property name="basketcode" type="string">
      <column length="20" name="BASKETCODE" not-null="true"/>
    </property>
    <property name="basketdesc" type="string">
      <column length="50" name="BASKETDESC" not-null="true"/>
    </property>
    <property name="programid" type="string">
      <column length="20" name="PROGRAMID" not-null="true"/>
    </property>
    <property name="sectionid" type="string">
      <column length="20" name="SECTIONID" not-null="true"/>
    </property>
    <property name="subjecttypeid" type="string">
      <column length="20" name="SUBJECTTYPEID" not-null="true"/>
    </property>
    <property name="stynumber" type="byte">
      <column name="STYNUMBER" not-null="true" precision="2" scale="0"/>
    </property>
    <property name="optional" type="string">
      <column length="1" name="OPTIONAL">
        <comment>Yes/No ; backet type is option ?</comment>
      </column>
    </property>
    <property name="preferencetype" type="string">
      <column length="1" name="PREFERENCETYPE">
        <comment>[C]heckbox,[P]reference,[N]one</comment>
      </column>
    </property>
    <property name="totalsubject" type="java.lang.Short">
      <column name="TOTALSUBJECT" precision="3" scale="0">
        <comment>Total subject under the basket</comment>
      </column>
    </property>
    <property name="minsubject" type="java.lang.Short">
      <column name="MINSUBJECT" precision="3" scale="0">
        <comment>Minimum no of subject one can opt</comment>
      </column>
    </property>
    <property name="maxsubject" type="java.lang.Short">
      <column name="MAXSUBJECT" precision="3" scale="0">
        <comment>Maximum no of subject one can opt</comment>
      </column>
    </property>
    <property name="seqid" type="java.lang.Short">
      <column name="SEQID" precision="4" scale="0"/>
    </property>
    <property name="deactive" type="string">
      <column length="1" name="DEACTIVE"/>
    </property>
  </class>
  <query name="getMaxTotalSubjectBasketMaster">
      select max(bm.totalsubject) from BasketMaster as bm
       where EXISTS(
            select 1
            from ProgramSubjectTagging as pst where pst.id.registrationid = :registrationid
            and pst.id.instituteid = :instituteid
            and (pst.departmentid = :departmentid or :departmentid='ALL')
            and bm.id.instituteid = pst.id.instituteid
            and bm.id.basketid = pst.basketid
            and bm.programid = pst.programid
            and bm.sectionid = pst.sectionid
            and bm.stynumber = pst.stynumber
        )
        and EXISTS
        (
            select 1 from StudentSubjectChoiceMaster as sscm
            where sscm.id.instituteid = :instituteid
            and sscm.id.registrationid = :registrationid
            and bm.id.basketid = sscm.basketid
            and coalesce(sscm.deactive,'N') = 'N'
        )
        and bm.subjecttypeid
        NOT IN(
            select stm.id.subjecttypeid from SubjectTypeMaster as stm
            where stm.subjecttype = 'C'
            and stm.id.instituteid = :instituteid
            and coalesce(stm.deactive,'N') = 'N'
        )
        and bm.id.instituteid = :instituteid
        and coalesce(bm.deactive,'N') = 'N'
    </query>
  <query name="findBsketId_BasketMaster">


        select a from BasketMaster a
            where a.id.instituteid = ?
            and a.programid = ?
            and a.sectionid = ?
            and a.stynumber = ?
            and a.subjecttypeid = ?

    </query>
  <query name="findBasketMasterData">


       select a from BasketMaster a
            where a.id.instituteid = ?
            and a.programid = ?
            and a.sectionid = ?
            and a.stynumber = ?
            and a.subjecttypeid = ?
            order by a.basketcode

    </query>
  <query name="findAllBasketMasterData">


       select distinct a from BasketMaster a
            where a.id.instituteid = ?
            and a.programid = ?
            and a.sectionid = ?
            and a.stynumber = ?
            order by a.basketcode

    </query>
</hibernate-mapping>
